<!DOCTYPE html>
<html>      
    <head>
        <meta charset="utf-8" />
        <title>Phun CMS template editor</title>
        
        <link rel="stylesheet" href="css/create_ui/css/create-ui.css"/>
        <link rel="stylesheet" href="css/midgard_notifications/midgardnotif.css"/>
        <link rel="stylesheet" href="css/font_awesome/css/font-awesome.css"/>
        <script type="text/javascript" src="scripts/jquery.js"></script>
        <script type="text/javascript" src="scripts/jqueryui.js"></script>
        <script type="text/javascript" src="scripts/underscore.js"></script>
        <script type="text/javascript" src="scripts/backbone.js"></script>
        <script type="text/javascript" src="scripts/ckeditor/ckeditor.js"></script>
        <script type="text/javascript" src="scripts/phuncms.config.js"></script>
        <script type="text/javascript" src="scripts/vie.js"></script>
        <script type="text/javascript" src="scripts/create.js"></script>
        <script type="text/javascript" src="scripts/phuncms.js"></script>

        <link rel="stylesheet" href="scripts/codemirror/codemirror.css">
		<link rel="stylesheet" href="scripts/codemirror/addon/hint/show-hint.css">
		<link rel="stylesheet" href="css/editor.css">

		<script src="scripts/codemirror/codemirror.js"></script>
		<script src="scripts/codemirror/addon/hint/show-hint.js"></script>
		<script src="scripts/codemirror/addon/edit/closetag.js"></script>
		<script src="scripts/codemirror/addon/hint/html-hint.js"></script>
		<script src="scripts/codemirror/addon/mode/overlay.js"></script>
		<script src="scripts/codemirror/mode/xml/xml.js"></script>
		<script src="scripts/codemirror/mode/clike/clike.js"></script>
		<script src="scripts/codemirror/mode/javascript/javascript.js"></script>
		<script src="scripts/codemirror/mode/css/css.js"></script>
		<script src="scripts/codemirror/mode/htmlmixed/htmlmixed.js"></script>
		<script src="scripts/codemirror/mode/vash/vash.js"></script>
		<script src="scripts/phuncms.util.js"></script>

        
		<script>

	</script>
		<script type="text/javascript">
		    $(document).ready(function () {
		        var editorHolder = $("#code");
		        CodeMirror.commands.autocomplete = function (cm) {
		            CodeMirror.showHint(cm, CodeMirror.htmlHint);
		        };
		        var filePath = getParameterByName("path");

		        $("#path").val(filePath);
		        $("#returnUrl").val(window.location.pathname + window.location.search);
		        
		        // ajax load the data
		        $.ajax({
		            url: contentPath + "/RetrieveSecure?path=" + filePath,
		            cache: false,
		            data: null,
		            success: function (data) {
		                data += '';
		                $(".bar").hide();
		                $(".content").show();
		                if (filePath.indexOf(".vash") > 0 || filePath.indexOf(".js")) {
		                    var editor = CodeMirror.fromTextArea(editorHolder[0], {
		                        lineNumbers: true,
		                        mode: 'application/x-razor',
		                        indentUnit: 4,
		                        indentWithTabs: true,
		                        autoCloseTags: true,
		                        enterMode: "keep",
		                        tabMode: "shift",
		                        extraKeys: { "Ctrl-Space": "autocomplete" }
		                    });

		                    editor.setValue(data);
		                }
		                else {
		                    var editor = CKEDITOR.replace(editorHolder[0], {
		                        fullPage: data.toLowerCase().indexOf('<html>') > -1,
		                        extraPlugins: 'wysiwygarea,codemirror',
		                        height: '600px',
		                        enterMode: CKEDITOR.ENTER_BR
		                    });

		                    editor.setData(data);
		                }
		            }
		        });

		    });
		</script>
    </head>
    <body>
        <header>
            <h1><a href="/">Phun Cms template editor</a></h1>
        </header>
		<div class="bar">
		   <span class="sphere"></span>
		   <br />
		   Loading, please wait...
		</div>
        <div class="content" style="display: none">
            <form data-action="Update" method="POST">
                <div>
                    <input type="hidden" id="returnUrl" name="returnUrl"/>
                    <input type="hidden" id="path" name="path"/>
                    <textarea class="CodeMirror" id="code" name="data" ></textarea>
                </div>
                <input type="submit" value="save" />
            </form>
        </div>
    </body>
</html>
